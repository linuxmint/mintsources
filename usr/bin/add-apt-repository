#!/usr/bin/python3

import gettext
import os
import sys
from argparse import ArgumentParser

gettext.install("mintsources", "/usr/share/linuxmint/locale")

parser = ArgumentParser()
parser.add_argument("-y", "--yes", dest="forceYes", action="store_true",
    help=_("automatically confirm all prompts"), default=False)
parser.add_argument("-r", "--remove", dest="remove", action="store_true",
    help=_("remove the specified repository"), default=False)
parser.add_argument(dest='repository', nargs='+',
                    help=_("the repository/PPA identifier"))

if len(sys.argv[1:]) == 0:
    parser.print_help()
    parser.exit()

args = parser.parse_args()
if os.geteuid() != 0:
    print(_("Error: must run as root"))
    parser.exit(1)

# Call mintSources script with exec instead of system so that the exit status
# is returned to the caller
command = ["/usr/lib/linuxmint/mintSources/mintSources.py", "add-apt-repository"]
if args.forceYes:
    command.append("-y")
if args.remove:
    command.append("-r")
command.append(" ".join(args.repository))

os.execv(command[0], command)
