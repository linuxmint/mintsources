#!/usr/bin/python3

import argparse
import os
import sys
import gettext

if __name__ == '__main__':

    gettext.bindtextdomain("mintsources", "/usr/share/linuxmint/locale")
    gettext.textdomain("mintsources")
    _ = gettext.gettext

    parser = argparse.ArgumentParser()
    parser.add_argument(
        '--yes', '-y', action="store_true",
        help="force yes on all confirmation questions")
    parser.add_argument(
        '--remove', '-r', action="store_true",
        help="Remove the specified repository")
    parser.add_argument('repository')

    args = parser.parse_args()

    if os.geteuid() != 0:
        print(_("Error: must run as root"))
        sys.exit(1)

    # Call mintSources script with exec instead of system so that the exit
    # status is returned to the caller
    mintsources = "/usr/lib/linuxmint/mintSources/mintSources.py"

    if args.yes:
        yes_arg = "-y"
    else:
        yes_arg = "-?"

    if args.remove:
        remove_arg = "-r"
    else:
        remove_arg = "-?"

    os.execl(
        mintsources, mintsources, "add-apt-repository",
        yes_arg, remove_arg, args.repository)
